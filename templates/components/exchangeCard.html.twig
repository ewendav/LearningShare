
<div class="session-card">
    {% if sidebar is defined and sidebar %}

  <div class="horizontal-display header-session-card"
  style="justify-content:space-between;"
  >
    <div class="flex" style="gap:.5rem;" >
          <img
      {% if not avatar_path %}
        style="display:none;"
      {% endif %}
          src="{{ avatar_path }}" class="avatar" >
        {% if app.user %}
            <p><a href="{{ path('app_user_profile', {'id': userId}) }}">{{userName}}</a></p>
        {% else %}
            <p>{{userName}}</p>
        {% endif %}
    </div>

      <h3 class="lesson-title"> {{ "Vous partagez"|trans }}
      </h3>

      </div>

    {% else %}

  <div class="horizontal-display header-session-card">


    <div class="flex" style="gap:.5rem;" >
          <img

      {% if not avatar_path %}
        style="opacity:0;"
      {% endif %}
          src="{{ avatar_path }}" class="avatar" >
      {% if app.user %}
        <p><a href="{{ path('app_user_profile', {'id': userId}) }}">{{userName}}</a></p>
      {% else %}
        <p>{{userName}}</p>
      {% endif %}

    </div>

    <h3>{{ "Échange"|trans }}</h3>

    <div class="flex" style="gap:.5rem; opacity : 0;" >
      <img src="{{ avatar_path }}" class="avatar" >
      {% if app.user %}
        <p><a href="{{ path('app_user_profile', {'id': userId}) }}">{{userName}}</a></p>
      {% else %}
        <p>{{userName}}</p>
      {% endif %}

    </div>

  </div>

  {% endif %}


  <div class=" exchange-container horizontal-display">

    <div class="vertical-display">

      {%  if sidebar is defined and not sidebar%}

        <p style="text-decoration:underline;">{{ "Vous apprends"|trans }}</p>

      {% if skill_taught_category_id is defined and skill_taught_category_id is not empty %}
        {% set catId = skill_taught_category_id|number_format(0, '', '') %}
        <p>{{ "Catégorie"|trans }} : {{ categoriesIndexed[catId]['name']|default('') }}</p>
      {% elseif categoryLearned is not empty %}
        <p>{{ "Catégorie"|trans }} : {{ categoryLearned }}</p>
      {% else %}
        <p>{{ "Catégorie"|trans }} : Non spécifiée</p>
      {% endif %}

      <p>{{ "Compétence"|trans }} : {{ skillLearned }}</p>

      {% else %}

        <p style="text-decoration:underline;" >{{ "Veux apprendre"|trans }}</p>
      {% if skill_requested_category_id is defined and skill_requested_category_id is not empty %}
        {% set catId = skill_requested_category_id|number_format(0, '', '') %}
        <p>{{ "Catégorie"|trans }} : {{ categoriesIndexed[catId]['name']|default('') }}</p>
      {% elseif categoryWanted is not empty %}
        <p>{{ "Catégorie"|trans }} : {{ categoryWanted }}</p>
      {% else %}
        <p>{{ "Catégorie"|trans }} : Non spécifiée</p>
      {% endif %}

      <p>{{ "Compétence"|trans }} : {{ skillWanted }}</p>

      {% endif %}

    </div>


<svg class="echange-logo" width="51" height="50" viewBox="0 0 51 50" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13.45 27.1251L5.72087 34.8542C5.57503 35.0001 5.45003 35.1876 5.3667 35.3959C5.3667 35.4167 5.3667 35.4376 5.34587 35.4584C5.28337 35.6251 5.2417 35.7917 5.2417 35.9792C5.2417 36.3959 5.40837 36.7917 5.70003 37.0834L13.45 44.8542C14.0542 45.4584 15.0542 45.4584 15.6584 44.8542C16.2625 44.2501 16.2625 43.2501 15.6584 42.6459L10.5542 37.5417L44.3042 37.5417C45.1584 37.5417 45.8667 36.8334 45.8667 35.9792C45.8667 35.1251 45.1584 34.4167 44.3042 34.4167L10.575 34.4167L15.6584 29.3334C15.9709 29.0209 16.1167 28.6251 16.1167 28.2292C16.1167 27.8334 15.9709 27.4376 15.6584 27.1251C15.0542 26.5209 14.075 26.5209 13.45 27.1251Z" fill="var(--main-black)"/>
<path d="M35.45 5.14583C34.8459 5.75 34.8459 6.75 35.45 7.35417L40.5542 12.4583L6.8042 12.4583C5.95003 12.4583 5.2417 13.1667 5.2417 14.0208C5.2417 14.875 5.95003 15.5833 6.8042 15.5833L40.5334 15.5833L35.45 20.6667C34.8459 21.2708 34.8459 22.2708 35.45 22.875C36.0542 23.4792 37.0542 23.4792 37.6584 22.875L45.3875 15.1458C45.5334 15 45.6584 14.8125 45.7417 14.6042C45.7417 14.5833 45.7417 14.5625 45.7625 14.5417C45.825 14.375 45.8667 14.1875 45.8667 14C45.8667 13.5833 45.7 13.1875 45.4084 12.8958L37.6584 5.14583C37.0334 4.54167 36.0542 4.54167 35.45 5.14583Z" fill="var(--main-black)"/>
</svg>

    <div class="vertical-display">

      {%  if sidebar is defined and not sidebar%}

        <p style="text-decoration:underline;" >{{ "Veux apprendre"|trans }}</p>

      <p>{{ "Catégorie"|trans }} : {{ categoryWanted }}</p>

      <p>{{ "Compétence"|trans }} : {{ skillWanted }}</p>

      {% else %}

        <p style="text-decoration:underline;">{{ "Vous apprends"|trans }}</p>
      {% if skill_taught_category_id is defined and skill_taught_category_id is not empty %}
        {% set catId = skill_taught_category_id|number_format(0, '', '') %}
        <p>{{ "Catégorie"|trans }} : {{ categoriesIndexed[catId]['name']|default('') }}</p>
      {% elseif categoryLearned is not empty %}
        <p>{{ "Catégorie"|trans }} : {{ categoryLearned }}</p>
      {% else %}
        <p>{{ "Catégorie"|trans }} : Non spécifiée</p>
      {% endif %}

      <p>{{ "Compétence"|trans }} : {{ skillLearned }}</p>

      {% endif %}

    </div>

  </div>

      <span class="date-info">
      {{dateDebut}}
      <br>
{{ startTime|date('H:i') }} - {{ endTime|date('H:i') }}
      </span>

    {% if app.user %}
        {% set viewed_profile_id = app.request.attributes.get('id') %}
        {% set is_viewing_own_profile = viewed_profile_id is null or viewed_profile_id|number_format == app.user.id %}
        
        {% if app.user.id == userId %}
            {# User is the creator of the exchange - show cancel button only if viewing own profile #}
            {% if is_viewing_own_profile %}
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <a href="{{ path('app_session_edit', {'id': session_id, 'type': 'exchange'}) }}" style="flex: 1;">
                        <button class="form-button" style="width:100%; background-color:#28a745;" type="button">
                            <i class="fas fa-edit"></i> {{ "Modifier"|trans }}
                        </button>
                    </a>
                </div>
                <form action="{{ path('app_cancel_exchange', {'id': session_id}) }}" method="POST">
                    {% if csrf_protection is defined and csrf_protection %}
                        <input type="hidden" name="token" value="{{ csrf_token('cancel-exchange-' ~ session_id) }}">
                    {% endif %}
                    <button class="form-button" style="width:100%; background-color:#007bff;" type="submit">{{ "Annuler"|trans }}</button>
                </form>
            {% endif %}
        {% else %}
            {% set userAttending = false %}
            {% for exchange in app.user.exchangesAttended %}
                {% if exchange.session.id == session_id %}
                    {% set userAttending = true %}
                {% endif %}
            {% endfor %}

            {% if not userAttending %}
                <form action="{{ path('app_join_exchange', {'id': session_id}) }}" method="POST">
                    {% if csrf_protection is defined and csrf_protection %}
                        <input type="hidden" name="token" value="{{ csrf_token('join-exchange-' ~ session_id) }}">
                    {% endif %}
                    <button style="width:100%" class="form-button green-bg" type="submit">{{ "Rejoindre le partage"|trans }}</button>
                </form>
            {% else %}
                {# Show leave button only if viewing own profile #}
                {% if is_viewing_own_profile %}
                    <form action="{{ path('app_leave_exchange', {'id': session_id}) }}" method="POST">
                        {% if csrf_protection is defined and csrf_protection %}
                            <input type="hidden" name="token" value="{{ csrf_token('leave-exchange-' ~ session_id) }}">
                        {% endif %}
                        <button class="form-button" style="width:100%; background-color:#d9534f;" type="submit">{{ "Se désinscrire"|trans }}</button>
                    </form>
                {% endif %}
            {% endif %}
        {% endif %}
    {% else %}
        <a href="{{ path('app_login') }}">
            <button style="width:100%" class="form-button green-bg" type="button">{{ "Rejoindre le partage"|trans }}</button>
        </a>
    {% endif %}

</div>
